{% extends "base.html" %}

{% block title %}Admin Panel - Driver Testing Platform{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>ðŸ”§ Admin Panel</h1>
        <p>Manage questions, users, and platform content</p>
    </div>

    <div class="admin-tabs">
        <button class="tab-btn active" onclick="showTab('questions')">Questions</button>
        <button class="tab-btn" onclick="showTab('users')">Users</button>
        <button class="tab-btn" onclick="showTab('stats')">Statistics</button>
    </div>

    <!-- Questions Tab -->
    <div id="questions-tab" class="tab-content active">
        <div class="tab-header">
            <h2>Manage Questions</h2>
            <button class="btn btn-primary" onclick="showAddQuestionForm()">Add New Question</button>
        </div>

        <div class="questions-list">
            {% for question in questions %}
            <div class="question-item">
                <div class="question-content">
                    <div class="question-header">
                        <span class="question-id">#{{ question.id }}</span>
                        <span class="question-category">{{ question.category }}</span>
                    </div>
                    <p class="question-text">{{ question.question_text }}</p>
                    <div class="question-options">
                        <span class="option">A: {{ question.option_a }}</span>
                        <span class="option">B: {{ question.option_b }}</span>
                        <span class="option">C: {{ question.option_c }}</span>
                    </div>
                    <div class="correct-answer">
                        <strong>Correct: {{ question.correct_answer }}</strong>
                    </div>
                </div>
                <div class="question-actions">
                    <button class="btn btn-secondary btn-sm" onclick="editQuestion({{ question.id }})">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteQuestion({{ question.id }})">Delete</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Users Tab -->
    <div id="users-tab" class="tab-content">
        <div class="tab-header">
            <h2>Manage Users</h2>
        </div>

        <div class="users-list">
            {% for user in users %}
            <div class="user-item">
                <div class="user-info">
                    <div class="user-header">
                        <span class="username">{{ user.username }}</span>
                        <span class="user-email">{{ user.email }}</span>
                    </div>
                    <div class="user-stats">
                        <span class="stat">Tests: {{ user.tests|length }}</span>
                        <span class="stat">Downloads: {{ user.downloads_count }}</span>
                        <span class="stat">Status: 
                            {% if user.is_subscriber %}
                                <span class="status subscribed">Premium</span>
                            {% else %}
                                <span class="status free">Free</span>
                            {% endif %}
                        </span>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="btn btn-secondary btn-sm" onclick="toggleSubscription({{ user.id }})">
                        {% if user.is_subscriber %}Remove Premium{% else %}Make Premium{% endif %}
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Statistics Tab -->
    <div id="stats-tab" class="tab-content">
        <div class="tab-header">
            <h2>Platform Statistics</h2>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Users</h3>
                <div class="stat-number">{{ stats.total_users }}</div>
            </div>
            <div class="stat-card">
                <h3>Premium Subscribers</h3>
                <div class="stat-number">{{ stats.premium_users }}</div>
            </div>
            <div class="stat-card">
                <h3>Total Tests Taken</h3>
                <div class="stat-number">{{ stats.total_tests }}</div>
            </div>
            <div class="stat-card">
                <h3>Total Questions</h3>
                <div class="stat-number">{{ stats.total_questions }}</div>
            </div>
        </div>

        <div class="recent-activity">
            <h3>Recent Activity</h3>
            <div class="activity-list">
                {% for activity in recent_activity %}
                <div class="activity-item">
                    <span class="activity-time">{{ activity.timestamp }}</span>
                    <span class="activity-text">{{ activity.description }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Question Modal -->
<div id="question-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <h2 id="modal-title">Add New Question</h2>
        <form id="question-form" class="question-form">
            <div class="form-group">
                <label for="question-text">Question Text</label>
                <textarea id="question-text" name="question_text" required rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="option-a">Option A</label>
                <input type="text" id="option-a" name="option_a" required>
            </div>
            
            <div class="form-group">
                <label for="option-b">Option B</label>
                <input type="text" id="option-b" name="option_b" required>
            </div>
            
            <div class="form-group">
                <label for="option-c">Option C</label>
                <input type="text" id="option-c" name="option_c" required>
            </div>
            
            <div class="form-group">
                <label for="correct-answer">Correct Answer</label>
                <select id="correct-answer" name="correct_answer" required>
                    <option value="">Select correct answer</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="category">Category</label>
                <input type="text" id="category" name="category" required>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeQuestionModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Question</button>
            </div>
        </form>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(tab => tab.classList.remove('active'));
    
    // Remove active class from all tab buttons
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => btn.classList.remove('active'));
    
    // Show selected tab content
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Add active class to clicked button
    event.target.classList.add('active');
}

function showAddQuestionForm() {
    document.getElementById('modal-title').textContent = 'Add New Question';
    document.getElementById('question-form').reset();
    document.getElementById('question-modal').style.display = 'flex';
}

function closeQuestionModal() {
    document.getElementById('question-modal').style.display = 'none';
}

function editQuestion(questionId) {
    // In a real app, you'd fetch question data and populate the form
    document.getElementById('modal-title').textContent = 'Edit Question';
    document.getElementById('question-modal').style.display = 'flex';
}

function deleteQuestion(questionId) {
    if (confirm('Are you sure you want to delete this question?')) {
        // In a real app, you'd send a DELETE request
        alert('Question deleted! (Demo mode)');
    }
}

function toggleSubscription(userId) {
    // In a real app, you'd send a request to toggle subscription
    alert('Subscription toggled! (Demo mode)');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('question-modal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
}

// Handle question form submission
document.getElementById('question-form').addEventListener('submit', function(e) {
    e.preventDefault();
    // In a real app, you'd send the form data to the server
    alert('Question saved! (Demo mode)');
    closeQuestionModal();
});
</script>
{% endblock %}


