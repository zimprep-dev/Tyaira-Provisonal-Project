{% extends "base.html" %}

{% block content %}
<div class="subscription-page">
    <h1>üíé Premium Subscription Plans</h1>
    
    <!-- Current Subscription Status -->
    {% if has_subscription %}
    <div class="subscription-status active">
        <h2>‚úÖ Active Subscription</h2>
        {% if latest_transaction %}
        <p><strong>Plan:</strong> {{ latest_transaction.plan.name if latest_transaction.plan else 'Premium' }}</p>
        <p><strong>Started:</strong> {{ latest_transaction.subscription_start.strftime('%B %d, %Y') if latest_transaction.subscription_start else 'N/A' }}</p>
        <p><strong>Expires:</strong> {{ current_user.subscription_end_date.strftime('%B %d, %Y') if current_user.subscription_end_date else 'N/A' }}</p>
        <p><strong>Status:</strong> <span class="badge badge-success">Active</span></p>
        {% endif %}
    </div>
    {% else %}
    <div class="subscription-status inactive">
        <h2>üîí No Active Subscription</h2>
        <p>Upgrade to Premium to get unlimited access to all driving theory tests!</p>
    </div>
    {% endif %}

    <!-- Subscription Plans -->
    <div class="plans-container">
        <h2>Choose Your Plan</h2>
        
        <div class="plans-grid">
            {% for plan in plans %}
            <div class="plan-card {% if loop.index == 2 %}popular{% endif %}">
                {% if loop.index == 2 %}
                <div class="popular-badge">Most Popular</div>
                {% endif %}
                
                <div class="plan-header">
                    <h3>{{ plan.name }}</h3>
                    <div class="plan-price">
                        <span class="currency">$</span>
                        <span class="amount">{{ "%.2f"|format(plan.price) }}</span>
                    </div>
                    <div class="plan-duration">{{ plan.duration_days }} days access</div>
                </div>
                
                <div class="plan-description">
                    <p>{{ plan.description }}</p>
                </div>
                
                <div class="plan-features">
                    <ul>
                        <li>‚úÖ Unlimited practice tests</li>
                        <li>‚úÖ 400+ questions database</li>
                        <li>‚úÖ Detailed explanations</li>
                        <li>‚úÖ Progress tracking</li>
                        <li>‚úÖ Mobile friendly</li>
                        <li>‚úÖ No ads</li>
                    </ul>
                </div>
                
                <div class="plan-action">
                    {% if has_subscription %}
                    <button class="btn-subscribe" disabled>Current Plan</button>
                    {% else %}
                    <form method="POST" action="{{ url_for('initiate_payment', plan_id=plan.id) }}">
                        <button type="submit" class="btn-subscribe">Subscribe Now</button>
                    </form>
                    {% endif %}
                </div>
                
                <div class="plan-savings">
                    {% if plan.duration_days == 90 %}
                    <span class="savings-badge">Save 20%</span>
                    {% elif plan.duration_days == 180 %}
                    <span class="savings-badge">Save 33%</span>
                    {% elif plan.duration_days == 365 %}
                    <span class="savings-badge">Save 42%</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Benefits Section -->
    <div class="benefits-section">
        <h2>Why Go Premium?</h2>
        <div class="benefits-grid">
            <div class="benefit-card">
                <div class="benefit-icon">üìö</div>
                <h3>Complete Question Bank</h3>
                <p>Access all 400+ professionally curated driving theory questions</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">üìä</div>
                <h3>Track Your Progress</h3>
                <p>Detailed analytics and performance insights to help you improve</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">üéØ</div>
                <h3>Targeted Practice</h3>
                <p>Focus on specific categories or difficulty levels</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">‚è±Ô∏è</div>
                <h3>Timed Tests</h3>
                <p>Simulate real exam conditions with customizable timers</p>
            </div>
        </div>
    </div>

    <!-- Payment Info -->
    <div class="payment-info">
        <h3>üí≥ Secure Payment</h3>
        <p>All payments are processed securely through Paynow. Your subscription activates instantly after payment confirmation.</p>
        <p><small>‚úÖ Secure checkout &nbsp; | &nbsp; üîí SSL encrypted &nbsp; | &nbsp; üì± Mobile friendly</small></p>
    </div>
</div>

<style>
.subscription-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.subscription-page h1 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 2.5rem;
    color: #333;
}

.subscription-status {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 40px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.subscription-status.active {
    border-left: 5px solid #28a745;
}

.subscription-status.inactive {
    border-left: 5px solid #ffc107;
}

.subscription-status h2 {
    margin-top: 0;
    margin-bottom: 15px;
}

.badge {
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.9rem;
}

.badge-success {
    background: #28a745;
    color: white;
}

.plans-container {
    margin-bottom: 50px;
}

.plans-container h2 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 2rem;
}

.plans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.plan-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
    overflow: hidden;
}

.plan-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.plan-card.popular {
    border: 3px solid #007bff;
    transform: scale(1.05);
}

.popular-badge {
    position: absolute;
    top: 20px;
    right: -35px;
    background: #007bff;
    color: white;
    padding: 5px 40px;
    transform: rotate(45deg);
    font-size: 0.9rem;
    font-weight: bold;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.plan-header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
}

.plan-header h3 {
    margin: 0 0 15px 0;
    font-size: 1.5rem;
    color: #333;
}

.plan-price {
    margin: 15px 0;
}

.plan-price .currency {
    font-size: 1.5rem;
    vertical-align: super;
}

.plan-price .amount {
    font-size: 3rem;
    font-weight: bold;
    color: #007bff;
}

.plan-duration {
    color: #666;
    font-size: 0.9rem;
}

.plan-description {
    margin-bottom: 20px;
    text-align: center;
    color: #666;
}

.plan-features ul {
    list-style: none;
    padding: 0;
    margin: 20px 0;
}

.plan-features li {
    padding: 8px 0;
    font-size: 0.95rem;
}

.plan-action {
    margin-top: 25px;
}

.btn-subscribe {
    width: 100%;
    padding: 15px;
    font-size: 1.1rem;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-subscribe:hover:not(:disabled) {
    background: linear-gradient(135deg, #0056b3, #003d82);
    transform: scale(1.05);
}

.btn-subscribe:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.plan-savings {
    text-align: center;
    margin-top: 15px;
}

.savings-badge {
    background: #28a745;
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: bold;
}

.benefits-section {
    margin: 60px 0;
}

.benefits-section h2 {
    text-align: center;
    margin-bottom: 40px;
    font-size: 2rem;
}

.benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
}

.benefit-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.benefit-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}

.benefit-card h3 {
    margin: 15px 0;
    color: #333;
}

.benefit-card p {
    color: #666;
    line-height: 1.6;
}

.payment-info {
    background: #f8f9fa;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    margin-top: 40px;
}

.payment-info h3 {
    margin-top: 0;
    color: #333;
}

.payment-info p {
    margin: 10px 0;
    color: #666;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .subscription-page h1 {
        font-size: 1.8rem;
    }
    
    .plans-grid {
        grid-template-columns: 1fr;
    }
    
    .plan-card.popular {
        transform: scale(1);
    }
    
    .benefits-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
