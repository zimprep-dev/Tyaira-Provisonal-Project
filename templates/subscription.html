{% extends "base.html" %}

{% block title %}Premium Subscription - Driver Testing Platform{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1><i data-feather="star" class="dashboard-icon"></i> Premium Subscription</h1>
        <div class="user-status">
            {% if has_subscription %}
                <span class="status-badge subscribed"><i data-feather="check-circle" class="badge-icon"></i> Active Subscription</span>
            {% else %}
                <span class="status-badge free"><i data-feather="lock" class="badge-icon"></i> Free Tier</span>
            {% endif %}
        </div>
    </div>

    <!-- Current Subscription Status -->
    {% if has_subscription and latest_transaction %}
    <div class="dashboard-stats">
        <div class="stat-card">
            <h3><i data-feather="award" class="stat-icon"></i> Status</h3>
            <div class="stat-number">Active</div>
        </div>
        <div class="stat-card">
            <h3><i data-feather="calendar" class="stat-icon"></i> Expires</h3>
            <div class="stat-number">{{ current_user.subscription_end_date.strftime('%b %d, %Y') if current_user.subscription_end_date else 'N/A' }}</div>
        </div>
        <div class="stat-card">
            <h3><i data-feather="dollar-sign" class="stat-icon"></i> Monthly</h3>
            <div class="stat-number">$5.00</div>
        </div>
    </div>
    {% endif %}

    <!-- Available Plans -->
    {% if not has_subscription %}
    <div class="plans-container">
        {% for plan in plans %}
        <div class="plan-card {% if plan.is_featured %}featured{% endif %}">
            <div class="plan-header">
                <h3><i data-feather="{% if plan.plan_type == 'usage' %}shopping-cart{% else %}zap{% endif %}" class="action-icon"></i> {{ plan.name }}</h3>
                {% if plan.is_featured %}
                <span class="featured-badge"><i data-feather="star"></i> Popular</span>
                {% endif %}
            </div>
            
            <div class="subscription-price">
                <span class="price-amount">${{ "%.2f"|format(plan.price) }}</span>
                <span class="price-period">
                    {% if plan.plan_type == 'usage' %}
                        one-time
                    {% else %}
                        / {{ plan.duration_months }} {% if plan.duration_months == 1 %}month{% else %}months{% endif %}
                    {% endif %}
                </span>
            </div>
            
            {% if plan.description %}
            <p class="plan-description">{{ plan.description }}</p>
            {% endif %}
            
            <div class="subscription-features">
                <ul>
                    <!-- Test Access -->
                    {% if plan.has_unlimited_tests %}
                    <li><i data-feather="check"></i> Unlimited practice tests</li>
                    {% elif plan.test_credits > 0 %}
                    <li><i data-feather="check"></i> {{ plan.test_credits }} test credits</li>
                    {% elif plan.max_tests_per_month %}
                    <li><i data-feather="check"></i> Up to {{ plan.max_tests_per_month }} tests/month</li>
                    {% else %}
                    <li><i data-feather="check"></i> Limited test access</li>
                    {% endif %}
                    
                    <!-- Always show question bank -->
                    <li><i data-feather="check"></i> 400+ questions database</li>
                    
                    <!-- PDF Downloads -->
                    {% if plan.has_download_access %}
                    <li><i data-feather="check"></i> PDF downloads</li>
                    {% endif %}
                    
                    <!-- Progress Tracking -->
                    {% if plan.has_progress_tracking %}
                    <li><i data-feather="check"></i> Progress tracking</li>
                    {% endif %}
                    
                    <!-- Performance Analytics -->
                    {% if plan.has_performance_analytics %}
                    <li><i data-feather="check"></i> Performance analytics</li>
                    {% endif %}
                    
                    <!-- Always mobile friendly -->
                    <li><i data-feather="check"></i> Mobile friendly interface</li>
                </ul>
            </div>

            <form method="POST" action="{{ url_for('initiate_payment', plan_id=plan.id) }}">
                <button type="submit" class="btn btn-primary btn-large">
                    <i data-feather="credit-card"></i> 
                    {% if plan.plan_type == 'usage' %}Buy Now{% else %}Subscribe Now{% endif %}
                </button>
            </form>

            <div class="payment-security">
                <small><i data-feather="lock"></i> Secure payment via Paynow â€¢ Instant activation</small>
            </div>
        </div>
        {% endfor %}
        
        {% if not plans or plans|length == 0 %}
        <div class="action-card">
            <p style="text-align: center; color: #666;">No subscription plans available at the moment.</p>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="dashboard-actions">
        <div class="action-card">
            <h3><i data-feather="info" class="action-icon"></i> Subscription Information</h3>
            <p>Your premium subscription is currently active. You have unlimited access to all features.</p>
            {% if current_user.subscription_end_date %}
            <p><strong>Your subscription will renew or expire on {{ current_user.subscription_end_date.strftime('%B %d, %Y') }}</strong></p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Benefits Section -->
    <div class="recent-tests">
        <h2><i data-feather="gift" class="section-icon"></i> What You Get with Premium</h2>
        <div class="test-results">
            <div class="test-result">
                <div class="test-date"><i data-feather="check-circle" style="color: #28a745;"></i> Unlimited Tests</div>
                <div class="test-score">Take as many practice tests as you need</div>
            </div>
            <div class="test-result">
                <div class="test-date"><i data-feather="database" style="color: #007bff;"></i> Full Question Bank</div>
                <div class="test-score">Access all 400+ driving theory questions</div>
            </div>
            <div class="test-result">
                <div class="test-date"><i data-feather="bar-chart-2" style="color: #ffc107;"></i> Performance Analytics</div>
                <div class="test-score">Track your progress and identify weak areas</div>
            </div>
            <div class="test-result">
                <div class="test-date"><i data-feather="smartphone" style="color: #17a2b8;"></i> Mobile Optimized</div>
                <div class="test-score">Study anywhere on any device</div>
            </div>
        </div>
    </div>
</div>

<style>
.plans-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.plan-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 2rem;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.plan-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

.plan-card.featured {
    border-color: #ffc107;
    background: linear-gradient(to bottom, #fffbeb 0%, white 15%);
}

.plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.plan-header h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.5rem;
}

.featured-badge {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: #ffc107;
    color: #000;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.featured-badge i {
    width: 14px;
    height: 14px;
}

.plan-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
}

.subscription-price {
    text-align: center;
    margin: 20px 0;
}

.price-amount {
    font-size: 3rem;
    font-weight: bold;
    color: #007bff;
}

.price-period {
    font-size: 1.2rem;
    color: #666;
}

.subscription-features {
    margin: 30px 0;
}

.subscription-features ul {
    list-style: none;
    padding: 0;
}

.subscription-features li {
    padding: 10px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.subscription-features li i {
    color: #28a745;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.subscription-features li.feature-disabled {
    opacity: 0.5;
}

.subscription-features li.feature-disabled i {
    color: #dc3545;
}

.btn-large {
    padding: 15px 30px;
    font-size: 1.1rem;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.payment-security {
    text-align: center;
    margin-top: 15px;
    color: #666;
}

.payment-security i {
    width: 16px;
    height: 16px;
    vertical-align: middle;
}

@media (max-width: 768px) {
    .plans-container {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
